### mongodb基础命令（所有大写均需替换为实际操作的数据库名或表名等）

- 查看当前数据库：db
- 查看所有数据库：show dbs
- 切换数据库（如果数据库不存在则创建数据库）：use DATABASE_NAME
- 删除当前数据库：db.dropDatabase()

### 集合（相当于关系数据库中的数据表）操作

- 查看已存在的集合：show collections

- 删除集合：db.COLLECTION_NAME.drop()

- 创建集合：db.createCollection(name, options)

  - name: 要创建的集合名称
  - options: 可选参数, 指定有关内存大小及索引的选项

  一般来说，我们创建集合用db.createCollection(name),如：db.createCollection("log"),创建一个名字为log的集合，没有任何的大小，数量限制，使用_id作为默认索引

  在 MongoDB 中，默认情况下你不需要创建集合。当你插入一些文档时，MongoDB 会自动创建集合

  ```
  > db.myCollection.insertOne( { x: 1 } )
  > show collections
  myCollection
  ...
  ```

### mongodb CRUD 操作（集合的增删改查操作）

​	**文档相当于关系型数据表中的行，给非关系型数据库的集合中插入文档相当于给关系型数据库的表中插入数据行**

- **插入文档**

  - 插入一个文档：[`db.collection.insertOne()`](https://docs.mongodb.com/manual/reference/method/db.collection.insertOne/#db.collection.insertOne) 

    ```
  db.inventory.insertOne(
       { item: "canvas", qty: 100, tags: ["cotton"], size: { h: 28, w: 35.5, uom: "cm" } }
    )
    ```
  
  - 插入多个文档：[`db.collection.insertMany()`](https://docs.mongodb.com/manual/reference/method/db.collection.insertMany/#db.collection.insertMany)

    ```
  db.inventory.insertMany([
       { item: "journal", qty: 25, tags: ["blank", "red"], size: { h: 14, w: 21, uom: "cm" } },
       { item: "mat", qty: 85, tags: ["gray"], size: { h: 27.9, w: 35.5, uom: "cm" } },
       { item: "mousepad", qty: 25, tags: ["gel", "blue"], size: { h: 19, w: 22.85, uom: "cm" } }
    ])
    ```
  
  - 插入一个或多个文档：[`db.collection.insert()`](https://docs.mongodb.com/manual/reference/method/db.collection.insert/#db.collection.insert)

------


- **查询文档**：db.collection.find( {<field1>: <value1>, ... } )

  **需要以易读的方式来读取数据，可以使用pretty()方法**：db.inventory.find( {<field1>: <value1>, ... } ).pretty()

  下面是mongodb操作和sql之间的**对应关系**

  |                         MongoDB操作                          |                     SQL关系型数据库操作                      |
  | :----------------------------------------------------------: | :----------------------------------------------------------: |
  |                   db.inventory.find( {} )                    |                   select * from inventory                    |
  |              db.inventory.find( {status: "D"} )              |          select * from inventory where status = "D"          |
  |    db.inventory.find( { status: { $in: [ "A", "D" ] } } )    |      select * from inventory where status in ("A", "D")      |
  |    db.inventory.find( { status: "A", qty: { $lt: 30 } } )    |   select * from inventory where status = "A" and qty < 30    |
  | db.inventory.find( { $or: [ { status: "A" }, { qty: { $lt: 30 } } ] } ) |    select * from inventory where status = "A" or qty < 30    |
  | db.inventory.find( { status: "A",   $or: [ { qty: { $lt: 30 } }, { item: /^p/ } ] } ) | select * from inventory where status = "A" and ( qty < 30 or item LIKE "p%") |

  mongodb中描述条件关系的操作与语法对应关系：

  |  关系操作  |         语法格式         |
  | :--------: | :----------------------: |
  |    等于    |    {<field>:<value>}     |
  |    小于    | {<field>:{$lt:<value>}}  |
  | 小于或等于 | {<field>:{$lte:<value>}} |
  |    大于    | {<field>:{$gt:<value>}}  |
  | 大于或等于 | {<field>:{$gte:<value>}} |
  |   不等于   | {<field>:{$ne:<value>}}  |

  查询并且只返回一个文档：db.collection.findOne( {<field1>: <value1>, ... } )

  ```
  > db.inventory.insertMany([
  ...    { item: "journal", qty: 25, size: { h: 14, w: 21, uom: "cm" }, status: "A" },
  ...    { item: "notebook", qty: 50, size: { h: 8.5, w: 11, uom: "in" }, status: "A" },
  ...    { item: "paper", qty: 100, size: { h: 8.5, w: 11, uom: "in" }, status: "D" },
  ...    { item: "planner", qty: 75, size: { h: 22.85, w: 30, uom: "cm" }, status: "D" },
  ...    { item: "postcard", qty: 45, size: { h: 10, w: 15.25, uom: "cm" }, status: "A" }
  ... ]);
  {
          "acknowledged" : true,
          "insertedIds" : [
                  ObjectId("5fde4a0a29acb9501f5474c2"),
                  ObjectId("5fde4a0a29acb9501f5474c3"),
                  ObjectId("5fde4a0a29acb9501f5474c4"),
                  ObjectId("5fde4a0a29acb9501f5474c5"),
                  ObjectId("5fde4a0a29acb9501f5474c6")
          ]
  }
  > db.inventory.find( {} )
  { "_id" : ObjectId("5fde4a0a29acb9501f5474c2"), "item" : "journal", "qty" : 25, "size" : { "h" : 14, "w" : 21, "uom" : "cm" }, "status" : "A" }
  { "_id" : ObjectId("5fde4a0a29acb9501f5474c3"), "item" : "notebook", "qty" : 50, "size" : { "h" : 8.5, "w" : 11, "uom" : "in" }, "status" : "A" }
  { "_id" : ObjectId("5fde4a0a29acb9501f5474c4"), "item" : "paper", "qty" : 100, "size" : { "h" : 8.5, "w" : 11, "uom" : "in" }, "status" : "D" }
  { "_id" : ObjectId("5fde4a0a29acb9501f5474c5"), "item" : "planner", "qty" : 75, "size" : { "h" : 22.85, "w" : 30, "uom" : "cm" }, "status" : "D" }
  { "_id" : ObjectId("5fde4a0a29acb9501f5474c6"), "item" : "postcard", "qty" : 45, "size" : { "h" : 10, "w" : 15.25, "uom" : "cm" }, "status" : "A" }
  > db.inventory.find( { status: "D" } )
  { "_id" : ObjectId("5fde4b0229acb9501f5474ce"), "item" : "paper", "qty" : 100, "size" : { "h" : 8.5, "w" : 11, "uom" : "in" }, "status" : "D" }
  { "_id" : ObjectId("5fde4b0229acb9501f5474cf"), "item" : "planner", "qty" : 75, "size" : { "h" : 22.85, "w" : 30, "uom" : "cm" }, "status" : "D" }
  > db.inventory.find( { status: { $in: [ "A", "D" ] } } )
  { "_id" : ObjectId("5fde4b0229acb9501f5474cc"), "item" : "journal", "qty" : 25, "size" : { "h" : 14, "w" : 21, "uom" : "cm" }, "status" : "A" }
  { "_id" : ObjectId("5fde4b0229acb9501f5474cd"), "item" : "notebook", "qty" : 50, "size" : { "h" : 8.5, "w" : 11, "uom" : "in" }, "status" : "A" }
  { "_id" : ObjectId("5fde4b0229acb9501f5474ce"), "item" : "paper", "qty" : 100, "size" : { "h" : 8.5, "w" : 11, "uom" : "in" }, "status" : "D" }
  { "_id" : ObjectId("5fde4b0229acb9501f5474cf"), "item" : "planner", "qty" : 75, "size" : { "h" : 22.85, "w" : 30, "uom" : "cm" }, "status" : "D" }
  { "_id" : ObjectId("5fde4b0229acb9501f5474d0"), "item" : "postcard", "qty" : 45, "size" : { "h" : 10, "w" : 15.25, "uom" : "cm" }, "status" : "A" }
  > db.inventory.find( { status: "A", qty: { $lt: 30 } } )
  { "_id" : ObjectId("5fde4b0229acb9501f5474cc"), "item" : "journal", "qty" : 25, "size" : { "h" : 14, "w" : 21, "uom" : "cm" }, "status" : "A" }
  > db.inventory.find( {
  ...      status: "A",
  ...      $or: [ { qty: { $lt: 30 } }, { item: /^p/ } ]
  ... } )
  { "_id" : ObjectId("5fde4b0229acb9501f5474cc"), "item" : "journal", "qty" : 25, "size" : { "h" : 14, "w" : 21, "uom" : "cm" }, "status" : "A" }
  { "_id" : ObjectId("5fde4b0229acb9501f5474d0"), "item" : "postcard", "qty" : 45, "size" : { "h" : 10, "w" : 15.25, "uom" : "cm" }, "status" : "A" }
  ```

  [query operations]: https://docs.mongodb.com/manual/tutorial/query-documents/	"更多操作参考官方文档"

------


- **更新文档**

  db.collection.update(
     <query>,
     {
       <update operator>: { <field1>: <value1>, ... },
       <update operator>: { <field2>: <value2>, ... },
    	 ...
     }
  )

  - 更新一个文档：db.collection.updateOne()

    The following example uses the [`db.collection.updateOne()`](https://docs.mongodb.com/manual/reference/method/db.collection.updateOne/#db.collection.updateOne) method on the `inventory` collection to update the *first* document where `item` equals `"paper"`:

    ```
    db.inventory.updateOne(
       { item: "paper" },
       {
         $set: { "size.uom": "cm", status: "P" },
         $currentDate: { lastModified: true }
       }
    )
    ```

    更新操作说明：

    - uses the [`$set`](https://docs.mongodb.com/manual/reference/operator/update/set/#up._S_set) operator to update the value of the `size.uom` field to `"cm"` and the value of the `status`field to `"P"`,
    - uses the [`$currentDate`](https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate) operator to update the value of the `lastModified` field to the current date. If`lastModified` field does not exist, [`$currentDate`](https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate) will create the field. See [`$currentDate`](https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate) for details.

  - 更新多个文档：db.collection.updateMany()

    The following example uses the [`db.collection.updateMany()`](https://docs.mongodb.com/manual/reference/method/db.collection.updateMany/#db.collection.updateMany) method on the `inventory` collection to update all documents where `qty` is less than `50`:

    ```
    db.inventory.updateMany(
       { "qty": { $lt: 50 } },
       {
         $set: { "size.uom": "in", status: "P" },
         $currentDate: { lastModified: true }
       }
    )
    ```

    更新操作说明：

    - uses the [`$set`](https://docs.mongodb.com/manual/reference/operator/update/set/#up._S_set) operator to update the value of the `size.uom` field to `"in"` and the value of the `status`field to `"P"`,
    - uses the [`$currentDate`](https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate) operator to update the value of the `lastModified` field to the current date. If`lastModified` field does not exist, [`$currentDate`](https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate) will create the field. See [`$currentDate`](https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate) for details.

  - 替换一个文档：db.collection.replaceOne()

    To replace the entire content of a document except for the `_id` field, pass an entirely new document as the second argument to [`db.collection.replaceOne()`](https://docs.mongodb.com/manual/reference/method/db.collection.replaceOne/#db.collection.replaceOne).

    替换除了文档 _id字段以外的其余全部内容

    当替换一个文档时，替换文档必须只能由 字段/值 的pair对 组成，不能包含更新操作表达式

    The following example replaces the *first* document from the `inventory` collection where `item: "paper"`:

    ```
    db.inventory.replaceOne(
       { item: "paper" },
       { item: "paper", instock: [ { warehouse: "A", qty: 60 }, { warehouse: "B", qty: 40 } ] }
    )
    ```


[update operations]: https://docs.mongodb.com/manual/tutorial/update-documents/	"更多操作参考官方文档"

------

- **删除文档**

  - 删除多个文档

    ```
    db.collection.deleteMany(
       <filter>,
       {
          writeConcern: <document>,
          collation: <document>
       }
    )
    ```

    - 删除所有文档：db.collection.deleteMany({})

    - 删除指定条件下的所有文档：db.collection.deleteMany({ <field1>: { <operator1>: <value1> }, ... })

      ex：removes all documents from the `inventory` collection where the `status` field equals `"A"`:

      ```
      db.inventory.deleteMany({ status : "A" })
      ```

  - 删除一个文档

    ```
    db.collection.deleteOne(
       <filter>,
       {
          writeConcern: <document>,
          collation: <document>,
          hint: <document|string>        // Available starting in MongoDB 4.4
       }
    )
    ```

    - 删除指定条件下的第一个文档：db.collection.deleteOne({<field1>: { <operator1>: <value1> }, ...})

      The following example deletes the *first* document where `status` is `"D"`:

      ```
      db.inventory.deleteOne( { status: "D" } )
      ```

  [delete operations]: https://docs.mongodb.com/manual/reference/delete-methods/#additional-deletes	"更多操作参考官方文档"

### mongodb中的数据类型

MongoDB在内部和网络传输上都以BSON格式存储数据

- JSON和BOSN的区别：

  - JSON 是把对象序列化为字符串，BSON 是把对象序列化为二进制，所以无论是在时间（序列化、反序列化的速度）还是空间（序列化之后的体积）上都优于 JSON，缺点就是二进制没什么可读性可言

  - BSON 比 JSON 支持更多的数据类型

    | JSON VS BSON |              JSON              |                           **BSON**                           |
    | :----------: | :----------------------------: | :----------------------------------------------------------: |
    |   Encoding   |          UTF-8 String          |                            Binary                            |
    | Data Support | String, Boolean, Number, Array | String, Boolean, Number (Integer, Float, Long, Decimal128...), Array, Date, Raw Binary |
    | Readability  |       Human and Machine        |                         Machine Only                         |

    [json vs bson]: https://www.mongodb.com/json-and-bson	"更多详情参考"

- mongodb支持的数据类型：https://docs.mongodb.com/manual/reference/operator/query/type/index.html#available-types

### mongodb高级查询

- 嵌套文档的查询

  ex : the following query selects all documents where the field `size` equals the document `{ h: 14, w:21, uom: "cm" }`

  ```
  db.inventory.find( { size: { h: 14, w: 21, uom: "cm" } } )
  ```

  说明：在整个嵌入式文档上的相等匹配要求与指定的值完全匹配，包括字段顺序。

- 嵌套字段的查询

  在嵌套文档上进行指定字段的查询，use [dot notation](https://docs.mongodb.com/manual/reference/glossary/#term-dot-notation)(`"field.nestedField"`).

  **使用点表示法查询时，字段和嵌套字段必须在引号内**

  ex：The following query uses the less than operator ([`$lt`](https://docs.mongodb.com/manual/reference/operator/query/lt/#op._S_lt)) on the field `h` embedded in the `size` field:

  ```
  db.inventory.find( { "size.h": { $lt: 15 } } )
  ```

  ex：The following query selects all documents where the nested field `h` is less than `15`, the nested field `uom` equals `"in"`, and the `status` field equals `"D"`:

  ```
  db.inventory.find( { "size.h": { $lt: 15 }, "size.uom": "in", status: "D" } )
  ```

- 匹配数组查询

  在数组上指定相等条件，使用{<field>：<value>}查询其中<value>>值>是要匹配的确切数组，包括元素的顺序

  ex：The following example queries for all documents where the field `tags` value is an array with exactly two elements, `"red"` and `"blank"`, in the specified order:

  ```
  db.inventory.find( { tags: ["red", "blank"] } )
  ```

  If, instead, you wish to find an array that contains both the elements `"red"` and `"blank"`, without regard to order or other elements in the array, use the [`$all`](https://docs.mongodb.com/manual/reference/operator/query/all/#op._S_all) operator：

  ```
  db.inventory.find( { tags: { $all: ["red", "blank"] } } )
  ```

- 匹配数组中的某一个元素

  ex：The following example queries for all documents where `tags` is an array that contains the string `"red"` as one of its elements：

  ```
  db.inventory.find( { tags: "red" } )
  ```

  ex：the following operation queries for all documents where the array `dim_cm` contains at least one element whose value is greater than `25`

  ```
  db.inventory.find( { dim_cm: { $gt: 25 } } )
  ```

- 在指定数组元素上匹配多个条件

  - 使用数组元素上的复合筛选条件查询

    ex：one element can satisfy the greater than `15` condition and another element can satisfy the less than `20` condition, or a single element can satisfy both

    数组dim_cm中的元素中至少有一个满足以下条件：要么大于15，要么小于20，或者两个条件都满足

    ```
    db.inventory.find( { dim_cm: { $gt: 15, $lt: 20 } } )
    ```

  - 在数组Array元素上满足多个条件的查询

    使用 [`$elemMatch`](https://docs.mongodb.com/manual/reference/operator/query/elemMatch/#op._S_elemMatch) 操作符在数组元素上指定满足多个条件，即至少有一个元素满足所有的条件

    ex：The following example queries for documents where the `dim_cm` array contains at least one element that is both greater than ([`$gt`](https://docs.mongodb.com/manual/reference/operator/query/gt/#op._S_gt)) `22` and less than ([`$lt`](https://docs.mongodb.com/manual/reference/operator/query/lt/#op._S_lt)) `30`

    ```
    db.inventory.find( { dim_cm: { $elemMatch: { $gt: 22, $lt: 30 } } } )
    ```

  - 通过数组索引位置查询元素

    The following example queries for all documents where the second element in the array `dim_cm` is greater than `25`:

    ```
    db.inventory.find( { "dim_cm.1": { $gt: 25 } } )
    ```

  - 按数组长度查询数组  [`$size`](https://docs.mongodb.com/manual/reference/operator/query/size/#op._S_size) 

    the following selects documents where the array `tags` has 3 elements.

    ```
    db.inventory.find( { "tags": { $size: 3 } } )
    ```

- 嵌套文档中数组查询操作

  ```
  db.inventory.insertMany( [
     { item: "journal", instock: [ { warehouse: "A", qty: 5 }, { warehouse: "C", qty: 15 } ] },
     { item: "notebook", instock: [ { warehouse: "C", qty: 5 } ] },
     { item: "paper", instock: [ { warehouse: "A", qty: 60 }, { warehouse: "B", qty: 15 } ] },
     { item: "planner", instock: [ { warehouse: "A", qty: 40 }, { warehouse: "B", qty: 5 } ] },
     { item: "postcard", instock: [ { warehouse: "B", qty: 15 }, { warehouse: "C", qty: 35 } ] }
  ]);
  ```

  - 数组中嵌套的文档的查询

    ex：The following example selects all documents where an element in the `instock` array matches the specified document:

    ```
    db.inventory.find( { "instock": { warehouse: "A", qty: 5 } } )
    ```

    整个嵌套文档上的相等匹配要求与指定文档完全匹配，包括字段顺序

  - 在嵌套文档数组中的字段上指定查询条件

    ex：The following example selects all documents where the `instock` array has at least one embedded document that contains the field `qty` whose value is less than or equal to `20`:

    ```
    db.inventory.find( { 'instock.qty': { $lte: 20 } } )
    ```

  - 使用数组索引查询嵌套文档中的字段

    ex：The following example selects all documents where the `instock` array has as its first element a document that contains the field `qty` whose value is less than or equal to `20`

    ```
    db.inventory.find( { 'instock.0.qty': { $lte: 20 } } )
    ```

- 指定文档数组的多个条件查询

  - 一个嵌套文档在嵌套字段上满足多个查询条件 [`$elemMatch`](https://docs.mongodb.com/manual/reference/operator/query/elemMatch/#op._S_elemMatch) 

    ex：The following example queries for documents where the `instock` array has at least one embedded document that contains both the field `qty` equal to `5` and the field `warehouse` equal to `A`:

    ```
    db.inventory.find( { "instock": { $elemMatch: { qty: 5, warehouse: "A" } } } )
    ```

    ex：The following example queries for documents where the `instock` array has at least one embedded document that contains the field `qty` that is greater than `10` and less than or equal to `20`:

    ```
    db.inventory.find( { "instock": { $elemMatch: { qty: { $gt: 10, $lte: 20 } } } } )
    ```

  - 数组元素满足组合条件， 也就是满足多个条件之一或者任意多个条件组合的条件（包括所有条件都满足，中文翻译真的绕）

    ex：For example, the following query matches documents where any document nested in the `instock` array has the `qty` field greater than `10` and any document (but not necessarily the same embedded document) in the array has the `qty` field less than or equal to `20`

    ```
    db.inventory.find( { "instock.qty": { $gt: 10,  $lte: 20 } } )
    ```

    ex：The following example queries for documents where the `instock` array has at least one embedded document that contains the field `qty` equal to `5` and at least one embedded document (but not necessarily the same embedded document) that contains the field `warehouse` equal to `A`:

    ```
    db.inventory.find( { "instock.qty": 5, "instock.warehouse": "A" } )
    ```

- 返回查询后特定映射的字段

  默认情况下查询会返回匹配文档的所有字段

  |                         mongodb操作                          |                          sql操作                           |
  | :----------------------------------------------------------: | :--------------------------------------------------------: |
  |             db.inventory.find( { status: "A" } )             |         SELECT * from inventory WHERE status = "A"         |
  | db.inventory.find( { status: "A" }, { item: 1, status: 1 } ) | SELECT _id, item, status from inventory WHERE status = "A" |
  | db.inventory.find( { status: "A" }, { item: 1, status: 1, _id: 0 } ) |   SELECT item, status from inventory WHERE status = "A"    |

  - 返回除排除字段外的所有字段

    The following example which returns all fields except for the `status` and the `instock` fields in the matching documents:

    ```
    db.inventory.find( { status: "A" }, { status: 0, instock: 0 } )
    ```

  - 返回嵌入文档中的特定字段

    The following example returns:   `_id` field (returned by default),  `item` field,  `status` field,  `uom` field in the `size` document.

    ```
    db.inventory.find(
       { status: "A" },
       { item: 1, status: 1, "size.uom": 1 }
    )
    ```

  - 抑制嵌入文档中的特定字段

    The following example specifies a projection to exclude the `uom` field inside the `size` document. All other fields are returned in the matching documents:

    ```
    db.inventory.find(
       { status: "A" },
       { "size.uom": 0 }
    )
    ```

  - 数组中对嵌套文档的映射

    The following example specifies a projection to return: `_id` field (returned by default), The `item` field, The `status` field, The `qty` field in the documents embedded in the `instock` array.

    ```
    db.inventory.find( { status: "A" }, { item: 1, status: 1, "instock.qty": 1 } )
    ```

  - 返回数组中指定特定的数组元素  [`$elemMatch`](https://docs.mongodb.com/manual/reference/operator/projection/elemMatch/#proj._S_elemMatch), [`$slice`](https://docs.mongodb.com/manual/reference/operator/projection/slice/#proj._S_slice), and [`$`](https://docs.mongodb.com/manual/reference/operator/projection/positional/#proj._S_).

    The following example uses the [`$slice`](https://docs.mongodb.com/manual/reference/operator/projection/slice/#proj._S_slice) projection operator to return the last element in the `instock` array

    ```
    db.inventory.find( { status: "A" }, { item: 1, status: 1, instock: { $slice: -1 } } )
    ```

- 对空字段或缺失字段的查询

  - 相等过滤

    The `{ item : null }` query matches documents that either contain the `item` field whose value is `null` *or* that do not contain the `item` field

    ```
    db.inventory.find( { item: null } )
    ```

  - 类型检查

    The `{ item : { $type: 10 } }` query matches *only* documents that contain the `item` field whose value is`null`; i.e. the value of the `item` field is of [BSON Type](https://docs.mongodb.com/manual/reference/bson-types/) `Null` (type number `10`) . 

    []: https://docs.mongodb.com/manual/reference/operator/query/type/index.html#available-types	"类型链接"

    ```
    db.inventory.find( { item : { $type: 10 } } )
    db.inventory.find( { item : { $type: "null" } } )
    ```

    The query returns only the document where the `item` field has a value of `null`.

  - 存在性检查

    The `{ item : { $exists: false } }` query matches documents that do not contain the `item` field:

    ```
    db.inventory.find( { item : { $exists: false } } )
    ```

- 范围运算符：$in $nin 分别表示在和不在某个范围

- 支持正则表达式： // 或者 $regex

  ```
  db.products.find({sku:/^ab/}) # 以ab开头
  db.products.find({sku: {$regex:'cf$'}}) # 以cf结尾
  ```

[]: https://docs.mongodb.com/manual/reference/operator/query/	"更多高级查询操作"

### 数据的备份与恢复

- 数据的备份

  mongodump -h dbhost -d dbname -o dbdirectory

  - -h：

    MongDB所在服务器地址，例如：127.0.0.1，当然也可以指定端口号：127.0.0.1:27017

  - -d：

    需要备份的数据库实例，例如：test

  - -o：

    备份的数据存放位置，例如：d:\data\dump，当然该目录需要提前建立，在备份完成后，系统自动在dump目录下建立一个test目录，这个目录里面存放该数据库实例的备份数据

  To limit the amount of data included in the database dump, you can specify [`--db`](https://docs.mongodb.com/database-tools/mongodump/#cmdoption-mongodump-db) and [`--collection`](https://docs.mongodb.com/database-tools/mongodump/#cmdoption-mongodump-collection) as options to [`mongodump`](https://docs.mongodb.com/database-tools/mongodump/#bin.mongodump). For example:

  ```
  mongodump --collection=myCollection --db=test
  ```

  从非本地单神实例创建备份

  ```
  mongodump --host=mongodb1.example.net --port=3017 --username=user --password="pass" --out=/opt/backup/mongodump-2013-10-24
  ```

  ![](.\imgs\back_up.jpg)

- 数据的恢复

  ```
  mongorestore -h <hostname><:port> -d dbname <path>
  ```

  - --host <:port>, -h <:port>：

    MongoDB所在服务器地址，默认为： localhost:27017

  - --db , -d ：

    需要恢复的数据库实例，例如：test，当然这个名称也可以和备份时候的不一样，比如test2

  - --drop：

    恢复的时候，先删除当前数据，然后恢复备份的数据。就是说，恢复后，备份后添加修改的数据都会被删除，慎用哦！

  - <path>：

    mongorestore 最后的一个参数，设置备份数据所在位置，例如：c:\data\dump\test。

    你不能同时指定 <path> 和 --dir 选项，--dir也可以设置备份目录。

  - --dir：

    指定备份的目录

    你不能同时指定 <path> 和 --dir 选项。

[]: https://docs.mongodb.com/manual/tutorial/backup-and-restore-tools/	"更多示例参数详见官方文档"

